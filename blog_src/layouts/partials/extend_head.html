{{/* === Custom Head Extensions — final safe version (no duplicate JSON-LD) === */}}

{{ partial "gtm-head.html" . }}

{{/* Подключаем всё по частям */}}
{{ partial "custom/header-fix.html" . }}
{{ partial "custom/colors.html" . }}
{{ partial "custom/accordion.html" . }}
{{ partial "custom/accordion-faq.html" . }}
{{ partial "custom/icons-progress.html" . }}

<!-- section-design inject -->
<link rel="stylesheet" href="{{ "css/section-design.css" | absURL }}">
<script src="{{ "js/section-fadein.js" | absURL }}" defer></script>

<!-- Global width override for PaperMod -->
<style>
  :root {
    --main-width: 1152px;
    --nav-width: var(--main-width);
  }
</style>

<!-- Single Post Hero Styling (compact, full content width) -->
<style>
/* ===== Single Post — Compact Gradient Header ===== */
.post-single > header,
.post-single .post-header {
  background: linear-gradient(135deg, var(--brand-blue), var(--brand-cyan));
  border-radius: calc(var(--radius, 12px) + 2px);
  padding: 1.25rem 1.5rem;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
  margin: 1rem 0 1.75rem 0;
  color: #fff;
}

.post-single > header .post-title,
.post-single .post-header .post-title {
  color: #fff;
  margin: 0 0 .4rem 0;
  line-height: 1.25;
  font-weight: 800;
}

.post-single > header .post-meta,
.post-single .post-header .post-meta {
  color: #dbeafe;
  opacity: .95;
  font-size: .95rem;
}

.post-single > header a,
.post-single .post-header a {
  color: inherit;
  text-decoration: none;
  border-bottom: 1px dashed rgba(255,255,255,.35);
}
.post-single > header a:hover,
.post-single .post-header a:hover {
  border-bottom-color: rgba(255,255,255,.9);
}

body.dark .post-single > header,
body.dark .post-single .post-header {
  box-shadow: 0 6px 22px rgba(0, 0, 0, .35);
}
</style>

<!-- Universal OG image for social and SEO -->
<meta property="og:image" content="{{ .Site.BaseURL }}images/og/default.webp">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:image" content="{{ .Site.BaseURL }}images/og/default.webp">

{{/* === BEGIN: auto-bundle (deterministic order for FAQ+badges) === */}}
{{- $cssParts := slice -}}
{{- with (resources.Get "css/custom/colors.css") -}}  {{- $cssParts = $cssParts | append . -}}  {{- end -}}
{{- with (resources.Get "css/custom/icons-progress.css") -}}  {{- $cssParts = $cssParts | append . -}}  {{- end -}}
{{- with (resources.Get "css/custom/progress.css") -}}  {{- $cssParts = $cssParts | append . -}}  {{- end -}}
{{- with (resources.Get "css/custom/accordion.css") -}}  {{- $cssParts = $cssParts | append . -}}  {{- end -}}
{{- with (resources.Get "css/custom/accordion-faq.css") -}}  {{- $cssParts = $cssParts | append . -}}  {{- end -}}
{{- range (resources.Match "css/custom/*.css") -}}
  {{- if and (ne .Name "colors.css") (ne .Name "icons-progress.css") (ne .Name "progress.css") (ne .Name "accordion.css") (ne .Name "accordion-faq.css") (ne .Name "badges-responsive-fix.css") -}}
    {{- $cssParts = $cssParts | append . -}}
  {{- end -}}
{{- end -}}
{{- with (resources.Get "css/custom/badges-responsive-fix.css") -}}  {{- $cssParts = $cssParts | append . -}}  {{- end -}}
{{- if gt (len $cssParts) 0 -}}
  {{- with (resources.Get "css/custom/typography-merged.css") -}}  {{- $cssParts = $cssParts | append . -}}  {{- end -}}
  {{- with ($cssParts | resources.Concat "css/custom-bundle.css" | resources.Minify | resources.Fingerprint) -}}
<link rel="stylesheet" href="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous">
  {{- end -}}
{{- end -}}

{{- $jsParts := slice -}}
{{- with (resources.Get "js/custom/accordion.js") -}}  {{- $jsParts = $jsParts | append . -}}  {{- end -}}
{{- with (resources.Get "js/custom/accordion-faq.js") -}}  {{- $jsParts = $jsParts | append . -}}  {{- end -}}
{{- with (resources.Get "js/custom/icons-progress.js") -}}  {{- $jsParts = $jsParts | append . -}}  {{- end -}}
{{- with (resources.Get "js/custom/progress.js") -}}  {{- $jsParts = $jsParts | append . -}}  {{- end -}}
{{- range (resources.Match "js/custom/*.js") -}}
  {{- if and (ne .Name "accordion.js") (ne .Name "accordion-faq.js") (ne .Name "icons-progress.js") (ne .Name "progress.js") -}}
    {{- $jsParts = $jsParts | append . -}}
  {{- end -}}
{{- end -}}
{{- if gt (len $jsParts) 0 -}}
  {{- with ($jsParts | resources.Concat "js/custom-bundle.js" | resources.Minify | resources.Fingerprint) -}}
<script src="{{ .RelPermalink }}" defer integrity="{{ .Data.Integrity }}" crossorigin="anonymous"></script>
  {{- end -}}
{{- end -}}
{{/* === END: auto-bundle === */}}

<!-- === BreadcrumbList JSON-LD only (BlogPosting moved to templates/schema_json.html) === -->
{{ if .IsPage }}
  {{/* BlogPosting JSON-LD intentionally not emitted here to avoid duplicates */}}

  {{- $items := slice -}}
  {{- $ancestors := .Ancestors.Reverse -}}
  {{- $position := 1 -}}
  {{- range $ancestors }}
    {{- $items = $items | append (dict
        "@type" "ListItem"
        "position" $position
        "name" .Title
        "item" .Permalink
      ) -}}
    {{- $position = add $position 1 -}}
  {{- end -}}
  {{- $items = $items | append (dict
      "@type" "ListItem"
      "position" $position
      "name" .Title
      "item" .Permalink
    ) -}}
  {{- $breadcrumbs := dict
      "@context" "https://schema.org"
      "@type" "BreadcrumbList"
      "itemListElement" $items
  -}}
  <script type="application/ld+json">{{ $breadcrumbs | jsonify | safeJS }}</script>
{{ end }}

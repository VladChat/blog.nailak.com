{{/* layouts/partials/custom/accordion-faq.html — JSON-LD ONLY */}}
{{- if $.Scratch.Get "faq_rendered" -}}
  {{- /* уже отрисовано — пропускаем */ -}}
{{- else -}}
  {{- $html := .Content | safeHTML -}}
  {{- $faq := slice -}}

  {{- $m := findRE "(?is)<h2[^>]*>\\s*Frequently\\s+Asked\\s+Questions.*?</h2>([\\s\\S]*)" $html -}}
  {{- if gt (len $m) 0 -}}
    {{- $block := index $m 0 | htmlUnescape -}}

    {{- $re := `(?is)^\\s*Q:\\s*(.+?)\\s*\\n\\s*A:\\s*([\\s\\S]+?)(?:\\n{2,}|$)` -}}
    {{- range findRE $re $block -}}
      {{- $q := (index . 1 | plainify | htmlUnescape | trim | replaceRE `\\s+` " ") -}}
      {{- $a := (index . 2 | plainify | htmlUnescape | trim | replaceRE `\\s+` " ") -}}
      {{- if and $q $a -}}
        {{- $faq = $faq | append (dict
          "@type" "Question"
          "name" $q
          "acceptedAnswer" (dict "@type" "Answer" "text" $a)
        ) -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}

  {{- if gt (len $faq) 0 -}}
    <script type="application/ld+json">{{ dict
      "@context" "https://schema.org"
      "@type" "FAQPage"
      "mainEntity" $faq
    | jsonify }}</script>
    {{- $.Scratch.Set "faq_rendered" true -}}
  {{- end -}}
{{- end -}}

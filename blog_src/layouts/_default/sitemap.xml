{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:xhtml="http://www.w3.org/1999/xhtml">

  {{- $now := now -}}

  <!-- Главная страница -->
  <url>
    <loc>{{ .Site.BaseURL }}</loc>
    <lastmod>{{ $now.Format "2006-01-02T15:04:05+00:00" }}</lastmod>
    <changefreq>daily</changefreq>
    <priority>1.0</priority>
  </url>

  {{- range .Site.RegularPages }}
    {{/* Определяем даты из front matter или Git */}}
    {{- $pub := or .PublishDate .Date -}}
    {{- $lm := or .Lastmod $pub -}}
    {{- $age := sub $now.Unix $pub.Unix -}}

    {{/* Пропуск страниц с нулевой датой */}}
    {{- if ne ($lm.Format "2006") "0001" }}
      <url>
        <loc>{{ .Permalink }}</loc>

        {{/* если Lastmod новее публикации — используем его */}}
        <lastmod>{{ $lm.Format "2006-01-02T15:04:05+00:00" }}</lastmod>

        {{/* приоритет и частота по возрасту контента */}}
        {{- if lt $age 604800 }}           <!-- < 7 дней -->
          <changefreq>daily</changefreq>
          <priority>0.9</priority>
        {{- else if lt $age 2592000 }}     <!-- 7–30 дней -->
          <changefreq>weekly</changefreq>
          <priority>0.7</priority>
        {{- else if lt $age 7776000 }}     <!-- 30–90 дней -->
          <changefreq>monthly</changefreq>
          <priority>0.6</priority>
        {{- else }}                        <!-- > 90 дней -->
          <changefreq>monthly</changefreq>
          <priority>0.5</priority>
        {{- end }}
      </url>
    {{- end }}
  {{- end }}

</urlset>
